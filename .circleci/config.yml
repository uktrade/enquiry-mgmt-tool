version: 2.1
jobs:
  build:
    machine:
      docker_layer_caching: true
    working_directory: ~/emt
    steps:
      - checkout
      - run:
          name: Copy config
          command: cp sample_env .env
      - run:
          name: Build docker stack
          command: docker-compose up -d
      - run:
          name: Run unit tests
          command: docker-compose run app python -m pytest -s -vvv app/enquiries/tests
      - run:
          name: Run e2e tests
          command: docker-compose run app cypress run --browser chrome
      - store_artifacts:
          path: cypress/screenshots
